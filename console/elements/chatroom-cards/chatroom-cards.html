

<dom-module id="chatroom-cards">

<link rel="stylesheet" type="text/css" href="style.css">
<link rel="import" href="../../components/polymer/polymer.html">
<link rel="import" href="../../components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../components/paper-button/paper-button.html">
<link rel="import" href="../../components/iron-icons/iron-icons.html">


<template>
  <h1> Welcome</h1>
  <iron-ajax
      id="ajax"
          auto 
          url="{{url}}"
          method="{{method}}"
          on-response="handleResponse"
          handleAs="json">
  </iron-ajax>

  <template is="dom-repeat" items="{{data}}">


  
    <section class="chatroom-card" id="{{item.id}}" >     
      <p>{{item.id}}</p>     
      <h2>{{item.name}}</h2>     
      <a href="#!/chatroom/{{item.id}}" tabindex="-1">
        <paper-button href="new" class="green">
          <iron-icon icon="icons:settings"></iron-icon> Settings 
        </paper-button>
      </a>
         <paper-button on-click="delete" class="red"><iron-icon icon="icons:delete"></iron-icon> </paper-button>
    </section>
  </template>

</template>

<script>
  Polymer ({ 
    is: "chatroom-cards", 
    properties: {
      method: String,
      kick: {
       observer: '_highlightChanged'
      },
      url : {type: String, notify: true, reflectToAttribute: true}, 
      data : String,
    },
    ready: function(){
      this.kick = 0;
      this.method = 'get';
      this.url = 'https://salty-taiga-73405.herokuapp.com/api/v1/users/1/chat_rooms/';
      Polymer.dom(this).node.$.ajax.generateRequest();

    },
    delete: function(e){
      this.method = 'delete';
      this.url = 'https://salty-taiga-73405.herokuapp.com/api/v1/users/1/chat_rooms/'+e.target.parentNode.parentNode.id;
      Polymer.dom(this).node.$.ajax.generateRequest();
      this.kick++;
      e.target.parentNode.parentNode.className+= " hidden";
    },

    _highlightChanged: function(e) {
      this.method = 'get';
      this.url = 'https://salty-taiga-73405.herokuapp.com/api/v1/users/1/chat_rooms/';
      Polymer.dom(this).node.$.ajax.generateRequest();
    },

    handleResponse: function(data){
      if (data.detail.response !== null){
       this.data = data.detail.response.chat_rooms;

      }

    }
  }); 

</script>
</dom-module>
<dom-module id="site-config">
<link rel="stylesheet" type="text/css" href="style.css">
<link rel="import" href="../../components/polymer/polymer.html">
<link rel="import" href="../../components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../components/paper-button/paper-button.html">
<link rel="import" href="../../components/paper-input/paper-input.html">
<link rel="import" href="../../components/iron-icons/iron-icons.html">

<template>
	<content></content>
<iron-ajax auto id="ajax" url="{{url}}" method="{{method}}" body="{{body}}" handle-as="json" content-type="application/json" on-response="responseHandler" on-error="errorHandler"></iron-ajax>

	<paper-button on-click="removeSite" class="remove">Remove Site</paper-button>
	<paper-input on-change="_uriChanged" id="site-url" auto-validate required  label="Site URL" value="{{uri}}"></paper-input>
	<section class="colours">
		<paper-input on-change="_bgChanged" pattern="[0-9a-f]*" char-counter maxlength="6" auto-validate required error-message="Invalid Colour!" label="Background Colour" value="{{bgcolour}}"><div prefix>#</div></paper-input>
		<paper-input on-change="_txtChanged" pattern="[0-9a-f]*" char-counter maxlength="6" auto-validate required error-message="Invalid Colour!" label="Text Colour" value="{{textcolour}}"><div prefix>#</div></paper-input>
	</section>

</template>

<script>
  Polymer ({ 
   is: "site-config", 

   properties: {
      url : String, 
      method : String,
      body: String,
      chatroom: String,
      uid: String,
   		uri : String,
   		textcolour : String, 
      bgcolour:  String,
      auto: Boolean, 

  },
  _uriChanged: function(){
    if(this.auto){
      this.method = "PATCH";
      var BASE_URL = 'https://salty-taiga-73405.herokuapp.com/api/v1/';
      var USER_ID = '1'; 
      this.url = BASE_URL+"users/"+USER_ID+"/chat_rooms/"+this.chatroom+"/hosts/"+this.uid; 
      this.body = '{"host":{ "uri":"'+this.uri+'"}}';
    }
  },
  _bgChanged: function(){
    if(this.auto){
      this.method = "PATCH";
      var BASE_URL = 'https://salty-taiga-73405.herokuapp.com/api/v1/';
      var USER_ID = '1'; 
      this.url = BASE_URL+"users/"+USER_ID+"/chat_rooms/"+this.chatroom+"/hosts/"+this.uid; 
      this.body = '{"host":{ "bg_colour":"'+this.bgcolour+'"}}';
    }
   },
  _txtChanged: function(){
    if(this.auto){
      this.method = "PATCH";
      var BASE_URL = 'https://salty-taiga-73405.herokuapp.com/api/v1/';
      var USER_ID = '1'; 
      this.url = BASE_URL+"users/"+USER_ID+"/chat_rooms/"+this.chatroom+"/hosts/"+this.uid; 
      this.body = '{"host":{ "text_colour":"'+this.textcolour+'"}}';
    }
    
  },
  ready: function(){
  },
          
  removeSite: function(e){
    if(this.auto){
   	  e.target.parentElement.parentElement.removeChild(e.target.parentElement);
      this.method = "DELETE"; 
      var BASE_URL = 'https://salty-taiga-73405.herokuapp.com/api/v1/';
      var USER_ID = '1'; 
      this.url = BASE_URL+"users/"+USER_ID+"/chat_rooms/"+this.chatroom+"/hosts/"+this.uid; 
      this.body = '';
    }
  },  
  responseHandler: function(e){
    // console.log(e);
  },
  errorHandler: function(e){
    console.log(e);
  }

  }); 

</script>
</dom-module>